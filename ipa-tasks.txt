
playbook: ansible/ipa-playbook.yml

  play #1 (all): safe-guard against race condition	TAGS: []
    tasks:
      wait for the node to be ready	TAGS: [bootstrap]

  play #2 (all): install IPA base system	TAGS: []
    tasks:
      bootstrap : Check default route	TAGS: [bootstrap]
      bootstrap : Create some default route	TAGS: [bootstrap]
      bootstrap : Check for dnf command	TAGS: [bootstrap, package-install]
      bootstrap : Auto select fastest DNF mirror	TAGS: [bootstrap, package-install]
      bootstrap : Refresh dnf cache	TAGS: [bootstrap, network, package-install]
      bootstrap : Install python2 and deps for ansible modules	TAGS: [bootstrap, network, package-install]
      bootstrap : Gather facts	TAGS: [bootstrap]
      bootstrap : Create directories in ipa_data_dir	TAGS: [bootstrap]
      bootstrap : Dummy (for ansible.skip_tags)	TAGS: [dummy]
      common : DNF or YUM?	TAGS: [common]
      common : Default facts (enable_packages, enable_network)	TAGS: [common]
      common : Override enable_packages=true	TAGS: [common, package-install]
      common : Override enable_network=true	TAGS: [common, network]
      common : Get nmcli device info	TAGS: [common]
      common : Set nmcli device info fact	TAGS: [common]
      common : fix /etc/hosts	TAGS: [common]
      common : Set FQDN hostname	TAGS: [common]
      common : Get timedatectl information	TAGS: [common]
      common : Set timezone to UTC	TAGS: [common]
      common : Disable dnf repos to prevent network access	TAGS: [common]
      common : Enable dnf repos	TAGS: [common]
      common : Auto select fastest DNF mirror	TAGS: [common, package-install]
      common : Enable yum for Fedora	TAGS: [common, network, package-install]
      common : Disable yum repos to prevent network access	TAGS: [common]
      common : Enable yum repos	TAGS: [common]
      common : Auto-select fastest yum mirror	TAGS: [common, network, package-install]
      common : Install gpg command for COPR / rpm_key	TAGS: [common, network, package-copr, package-install]
      common : Add GPG RPM keys for copr	TAGS: [common, network, package-copr, package-install]
      common : Enable extra COPRs	TAGS: [common, network, package-copr, package-install]
      common : upgrade all packages	TAGS: [common, network, package-install, package-upgrade]
      common : Create directory for custom RPMS	TAGS: [common, custom-rpms]
      common : Install rsync	TAGS: [common, custom-rpms, network, package-install]
      common : Synchronize RPMs	TAGS: [common, custom-rpms]
      common : find custom RPMs	TAGS: [common, custom-rpms]
      common : install custom RPMs	TAGS: [common, custom-rpms]
      common : install selinux tools	TAGS: [common, network, package-install]
      common : disable selinux for 389-DS installation	TAGS: [common, lxc]
      common : install firewalld	TAGS: [firewall, network, package-install, pki]
      common : check for firewalld	TAGS: [common, firewall]
      common : Enable and start firewalld	TAGS: [common, firewall]
      common : Open firewall ports elemental services	TAGS: [common, firewall]
      common : Install rng tools	TAGS: [common, network, package-install]
      common : Start the rngd service	TAGS: [common]
      common : tty-less sudo	TAGS: [common]
      ipa : make a copy of original resolv.conf	TAGS: [ipa]
      ipa : Get default DNS	TAGS: [ipa]
      ipa : Get reverse zone	TAGS: [ipa]
      ipa : Remove chrony (FreeIPA uses ntpd)	TAGS: [ipa, package-install]
      ipa : install FreeIPA client package (Fedora)	TAGS: [ipa, network, package-install]
      ipa : install FreeIPA client package (RHEL / CentOS)	TAGS: [ipa, network, package-install]
      ipa : Check for mod_ssl configuration	TAGS: [ipa]
      ipa : Disable mod_ssl configuration	TAGS: [ipa]
      ipa : Gather IPA facts	TAGS: [ipa]

  play #3 (ipaserver_master,ipaserver_replica): install IPA server system	TAGS: []
    tasks:
      ipaserver : install FreeIPA server package (Fedora)	TAGS: [ipaserver, network, package-install]
      ipaserver : install FreeIPA server package (RHEL / CentOS)	TAGS: [ipaserver, network, package-install]
      ipaserver : Open Firewall for services	TAGS: [firewall, ipaserver]

  play #4 (ipaserver_master): install FreeIPA server master	TAGS: []
    tasks:
      ipaserver-master : Install FreeIPA master (5-7 minutes)	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Install KRA on FreeIPA master (2-3 minutes)	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Update IPA facts	TAGS: [ipaserver-master]
      ipaserver-master : Make sure named-pkcs11 DNS is restarted	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : wait for services to come up	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set ipv4_dns fact	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Add replica to ipv4_dns fact	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.dns	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.dns-search	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.ignore-auto-dns	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Restart NetworkManager to make DNS changes effective	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set sensible defaults	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set home directory to /export/home	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set admin's home directory to /export/home/admin	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable password and OTP loging	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable global DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable reverse DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : signal FreeIPA master has been deployed	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Fetch IPA ca.crt	TAGS: [fetch, ipa-install, ipaserver-master]
      ipaserver-master : Copy IPA ca.crt to all machines	TAGS: [ipa-install, ipaserver-master]

  play #5 (ipaserver_master): create local inventory files	TAGS: []
    tasks:
      ipa-inventory : Create Firefox prefs	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create Firefox bookmarks	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Fetch Firefox files	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Copy local Firefox files	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Write custom krb5.conf	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Write custom krb5.conf for MS-KKDCP	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Fetch resolv.conf	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch IPA ca.crt	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch ipa default.conf	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch kra agent pem file	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Template local scripts	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Template local inventory files	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Check for NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create NSSDB directory	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Remove old CA.crt from NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Populate NSSDB with CA.crt	TAGS: [ipa-install, ipa-inventory]

  play #6 (ipaserver_replica): install FreeIPA server replica	TAGS: []
    tasks:
      ipaserver-replica : Create /export home directory with correct context	TAGS: [ipa-client, ipa-install]
      ipaserver-replica : join FreeIPA	TAGS: [ipa-client, ipa-install]
      ipaserver-replica : Update IPA facts	TAGS: [ipa-client]
      ipaserver-replica : install replica	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Prepare replication	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Fetch replication file	TAGS: [fetch, ipa-install, ipaserver-replica]
      ipaserver-replica : Copy replication file	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : install replica	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Update IPA facts	TAGS: [ipaserver-replica]
      ipaserver-replica : Install CA on FreeIPA replica (3-4 minutes)	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Install KRA on FreeIPA replica (2-3 minutes)	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Make sure named-pkcs11 DNS is restarted	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Update IPA facts	TAGS: [ipaserver-replica]

  play #7 (ipa_client,ipa_nfsserver,ipa_smbserver,ipa_vpnserver,ipa_httpexample,ipa_ipsilon_idp): install FreeIPA client	TAGS: []
    tasks:
      ipa-client : Create /export home directory with correct context	TAGS: [ipa-client, ipa-install]
      ipa-client : join FreeIPA	TAGS: [ipa-client, ipa-install]
      ipa-client : Update IPA facts	TAGS: [ipa-client]

  play #8 (ipa_vpnserver): install OpenConnect VPN server for FreeIPA	TAGS: []
    tasks:
      ipa-vpnserver : install ocserv VPN server	TAGS: [ipa-vpnserver, network, package-install]
      ipa-vpnserver : Open Firewall services for ocserv VPN server	TAGS: [firewall, ipa-vpnserver]
      ipa-vpnserver : Open Firewall DTLS UDP port for ocserv VPN server	TAGS: [firewall, ipa-vpnserver]
      ipa-vpnserver : Enable IPv4 proxy_arp	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Enable masquerading	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Get keytab /etc/ocserv/key.tab content	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Create VPN service	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Add VPN service to keytab /etc/ocserv/key.tab	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Look for /etc/pki/ocserv/public/server.crt	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Request certificate /etc/pki/ocserv/public/server.crt with ipa-getcert	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Wait for certmonger	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Create a link from /etc/pki/ocserv/cacerts/ca.crt to /etc/ipa/ca.crt	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Write ocserv.conf	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Enable ocserv	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Template local scripts	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Template local inventory files	TAGS: [ipa-install, ipa-vpnserver]
      ipa-vpnserver : Write custom krb5.conf	TAGS: [fetch, ipa-install, ipa-vpnserver]

  play #9 (ipa_nfsserver): install FreeIPA NFS server	TAGS: []
    tasks:
      ipa-nfsserver : install nfs-utils	TAGS: [ipa-nfsserver, network, package-install]
      ipa-nfsserver : Open Firewall for NFS	TAGS: [firewall, ipa-nfsserver]
      ipa-nfsserver : Get keytab content	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Create NFS service	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Add NFS service to keytab	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Create /exports/home	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Add NFS export	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Enable NFS server	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : look for auto.home in default location	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Set has_auto_home fact	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : add automount default location	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : add auto.home map	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : add auto.home to auto.master	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : automountkey-add default auto.home	TAGS: [ipa-install, ipa-nfsserver]
      ipa-nfsserver : Get FreeIPA users	TAGS: [ipa-install, ipa-nfs-homedirs, ipa-nfsserver]
      ipa-nfsserver : Create home directory for FreeIPA users	TAGS: [ipa-install, ipa-nfs-homedirs, ipa-nfsserver]
      ipa-nfsserver : Run ipa-client-automount on master, replicas and clients	TAGS: [ipa-install, ipa-nfsserver]

  play #10 (ipa_smbserver): install FreeIPA Samba server	TAGS: []
    tasks:
      ipa-smbserver : install Samba dependencies	TAGS: [ipa-smbserver, network, package-install]
      ipa-smbserver : Open Firewall for Samba	TAGS: [firewall, ipa-smbserver]
      ipa-smbserver : setsebool samba_enable_home_dirs on	TAGS: [ipa-install, ipa-smbserver]
      ipa-smbserver : Get keytab content	TAGS: [ipa-install, ipa-smbserver]
      ipa-smbserver : Create CIFS service	TAGS: [ipa-install, ipa-smbserver]
      ipa-smbserver : Add CIFS service to keytab	TAGS: [ipa-install, ipa-smbserver]
      ipa-smbserver : Write smb.conf	TAGS: [ipa-install, ipa-smbserver]
      ipa-smbserver : Enable Samba services	TAGS: [ipa-install, ipa-smbserver]

  play #11 (ipa_httpexample): install FreeIPA HTTP example app	TAGS: []
    tasks:
      ipa-httpd : install Apache HTTPD base	TAGS: [ipa-httpd, network, package-install]
      ipa-httpd : Open Firewall for Apache	TAGS: [firewall, ipa-httpd]
      ipa-httpd : Get keytab content	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Create HTTP service	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Add HTTP service to keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : chown http.keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Get ipa-getcert list	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Set has_server_cert fact	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Restart certmonger when in state CA_UNREACHABLE	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove example certs from /etc/httpd/alias NSSDB	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Request certificate with ipa-getcert	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Wait for certmonger	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Replace nss.conf port 8443 with 443	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove welcome.conf	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Enable Apache HTTPD service	TAGS: [ipa-http, ipa-install]
      ipa-httpexample : install Apache modules	TAGS: [ipa-httpexample, network, package-install]
      ipa-httpexample : setsebool allow_httpd_mod_auth_pam on	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : setsebool httpd_dbus_sssd on	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Enable rewrite engine for nss.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Add rewrite rule for / to nss.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Add ldap_user_extra_attrs to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Add [ifp]allowed_uids to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Add [ifp]user_attributes to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Add [ifp]user_attributes to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Create Apache config for example	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Copy Apache example app files	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Create Apache example app	TAGS: [ipa-httpexample, ipa-install]
      ipa-httpexample : Create PAM service for Apache example app	TAGS: [ipa-httpexample, ipa-install]

  play #12 (ipa_ipsilon_idp): install Ipsilon Identity Provider	TAGS: []
    tasks:
      ipa-httpd : install Apache HTTPD base	TAGS: [ipa-httpd, network, package-install]
      ipa-httpd : Open Firewall for Apache	TAGS: [firewall, ipa-httpd]
      ipa-httpd : Get keytab content	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Create HTTP service	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Add HTTP service to keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : chown http.keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Get ipa-getcert list	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Set has_server_cert fact	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Restart certmonger when in state CA_UNREACHABLE	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove example certs from /etc/httpd/alias NSSDB	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Request certificate with ipa-getcert	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Wait for certmonger	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Replace nss.conf port 8443 with 443	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove welcome.conf	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Enable Apache HTTPD service	TAGS: [ipa-http, ipa-install]
      ipa-ipsilon-idp : Install Ipsilon server packages	TAGS: [ipa-ipsilon-idp, network, package-install]
      ipa-ipsilon-idp : Disable mod_ssl configuration	TAGS: [ipa-install, ipa-ipsilon-idp]
      ipa-ipsilon-idp : Install Ipsilon IdP	TAGS: [ipa-install, ipa-ipsilon-idp]
      ipa-ipsilon-idp : Use NSS instead of mod_ssl	TAGS: [ipa-install, ipa-ipsilon-idp]

  play #13 (ipa_sp_example): install Ipsilon SP example	TAGS: []
    tasks:
      ipa-httpd : install Apache HTTPD base	TAGS: [ipa-httpd, network, package-install]
      ipa-httpd : Open Firewall for Apache	TAGS: [firewall, ipa-httpd]
      ipa-httpd : Get keytab content	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Create HTTP service	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Add HTTP service to keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : chown http.keytab	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Get ipa-getcert list	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Set has_server_cert fact	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Restart certmonger when in state CA_UNREACHABLE	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove example certs from /etc/httpd/alias NSSDB	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Request certificate with ipa-getcert	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Wait for certmonger	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Replace nss.conf port 8443 with 443	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Remove welcome.conf	TAGS: [ipa-httpd, ipa-install]
      ipa-httpd : Enable Apache HTTPD service	TAGS: [ipa-http, ipa-install]
      ipa-sp-example : Install Ipsilon client package	TAGS: [ipa-sp-example, network, package-install]
      ipa-sp-example : Set IdP url fact	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Check for /etc/httpd/conf.d/ipsilon-saml.conf	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Write password to file	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Install Ipsilon client	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Remove password file	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Create /srv/www/sp_example	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Create Apache SP example app	TAGS: [ipa-install, ipa-sp-example]
      ipa-sp-example : Overwrite ipsilon-saml.conf with custom config	TAGS: [ipa-install, ipa-sp-example]

  play #14 (ipa_tests): Create integration test files	TAGS: []
    tasks:
      ipa-tests : Create dot_ipa directories	TAGS: [ipa-tests]
      ipa-tests : Create default.conf	TAGS: [ipa-tests]
      ipa-tests : Create .dmpw	TAGS: [ipa-tests]
      ipa-tests : copy alias /etc/httpd/alias databases	TAGS: [ipa-tests]
      ipa-tests : copy /etc/httpd/alias/pwdfile.txt	TAGS: [ipa-tests]
      ipa-tests : copy /etc/ipa/ca.crt	TAGS: [ipa-tests]
      ipa-tests : create krb5.conf	TAGS: [ipa-tests]
      ipa-tests : Fetch dot_ipa	TAGS: [ipa-tests]
